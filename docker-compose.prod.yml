services:
  fast-aiogentic:
    image: ${IMAGE_NAME:-ghcr.io/jonesh/fast-aiogentic}:${IMAGE_TAG:-latest}
    container_name: fast-aiogentic
    restart: unless-stopped
    env_file: .env
    environment:
      - WEBHOOK_ENABLED=true
      - WEBHOOK_HOST=0.0.0.0
      - WEBHOOK_PORT=8000
      - WEBHOOK_URL=https://${BASE_DOMAIN:-jonaheidsick.de}/fast-aiogentic/webhook
      - WEBHOOK_PATH=/webhook
      - HEALTH_PATH=/health
    networks:
      - bot-network
      - edge
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M
    security_opt:
      - no-new-privileges:true
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.fast-aiogentic.rule=Host(`${BASE_DOMAIN:-jonaheidsick.de}`) && PathPrefix(`/fast-aiogentic`)"
      - "traefik.http.routers.fast-aiogentic.entrypoints=websecure"
      - "traefik.http.routers.fast-aiogentic.tls=true"
      - "traefik.http.routers.fast-aiogentic.tls.certresolver=letsencrypt"
      - "traefik.http.services.fast-aiogentic.loadbalancer.server.port=8000"
      - "traefik.http.routers.fast-aiogentic.middlewares=fast-aiogentic-strip,fast-aiogentic-security"
      - "traefik.http.middlewares.fast-aiogentic-strip.stripprefix.prefixes=/fast-aiogentic"
      - "traefik.http.middlewares.fast-aiogentic-security.headers.customresponseheaders.X-Content-Type-Options=nosniff"

networks:
  bot-network:
    driver: bridge
  edge:
    external: true
